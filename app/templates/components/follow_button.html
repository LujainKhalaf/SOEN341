{# Params:
    - following: Boolean
    - user: User
#}
{% macro follow_button(following, user, me) -%}
    <button id="follow-button" class="btn {{ 'btn-following' if following else 'btn-primary' }} shadow-none"
            onclick="follow(this)" this-user-id="{{ user.user_id }}" me-username="{{ me.username }}" me-full-name="{{ me.full_name }}" me-id="{{ me.user_id }}">
        {{ 'Following' if following else 'Follow' }}
    </button>

    <script>
        async function follow(e) {
            const userId = await e.getAttribute('this-user-id');
            const formData = new FormData();
            formData.append('user_id', userId);

            const followButton = document.getElementById('follow-button');
            const isFollowing = followButton.innerText === 'Follow';
            const myuserid= await e.getAttribute('me-id');
            if (isFollowing) {
                await fetch('/follow', {method: 'POST', body: formData});
                followButton.innerText = 'Following';
                followButton.title = 'Following';
                followButton.className = 'btn btn-following';
                const list = document.getElementById('modal-followers');
                const username = await e.getAttribute('me-username');
                const fullname = await e.getAttribute('me-full-name');

                var listitem =
                    `<div class="py-2" id="follower-list-item-${myuserid}">
                            <div class="display-inline-block comment-profile-img">
                                    <a href="/${username}"><img
                                            src="static/assets/default-profile-picture.png"
                                            class="post-comment-profile-pic rounded-circle"></a>
                                    </div>
                                <div class="post-comment-text">
                                    <a href="/${username}"><span
                                            class="post-comment-username">${username}</span></a>
                                    <div>
                                        <br>
                                        <span>${fullname}</span>
                                    </div>
                                </div>
                                    </div>`;
                const div = document.createElement('div');
                div.innerHTML = listitem;
                list.append(div);


            } else {
                await fetch('/unfollow', {method: 'POST', body: formData});
                followButton.innerText = 'Follow';
                followButton.title = 'Follow';
                followButton.className = 'btn btn-primary';
                const listuser = document.getElementById(`follower-list-item-${myuserid}`);
                listuser.parentNode.removeChild(listuser);
            }

            const followerCount = document.getElementById('follow-button-follower-count');
            const currentCount = parseInt(followerCount.innerText)
            followerCount.innerText = isFollowing ? `${currentCount + 1}` : `${currentCount - 1}`;
        }
    </script>
{%- endmacro %}
