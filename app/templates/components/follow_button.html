{# Params:
    - following: Boolean
    - user: User
#}
{% macro follow_button(following, user) -%}
    <button id="follow-button" class="btn {{ 'btn-following' if following else 'btn-primary' }} shadow-none"
            onclick="follow(this)" this-user-id="{{ user.user_id }}">
        {{ 'Following' if following else 'Follow' }}
    </button>

    <script>
        async function follow(e) {
            const userId = await e.getAttribute('this-user-id');
            const formData = new FormData();
            formData.append('user_id', userId);

            const followButton = document.getElementById('follow-button');
            const isFollowing = followButton.innerText === 'Follow';
            if (isFollowing) {
                await fetch('/follow', {method: 'POST', body: formData});
                followButton.innerText = 'Following';
                followButton.title = 'Following';
                followButton.className = 'btn btn-following';
            } else {
                await fetch('/unfollow', {method: 'POST', body: formData});
                followButton.innerText = 'Follow';
                followButton.title = 'Follow';
                followButton.className = 'btn btn-primary';
            }

            const followerCount = document.getElementById('follow-button-follower-count');
            const currentCount = parseInt(followerCount.innerText)
            followerCount.innerText = isFollowing ? `${currentCount + 1}` : `${currentCount - 1}`;
        }
    </script>
{%- endmacro %}
